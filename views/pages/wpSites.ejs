<body data-page-mode="wpSites">
    <header class="mb-6 pb-4 border-b border-slate-700 flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-bold text-white tracking-tight">Quản lý Trang Wordpress</h1>
            <p class="text-slate-400 mt-1">Thêm, sửa, và xóa các trang Wordpress liên kết</p>
        </div>
        <button id="btn-open-add-modal" class="flex items-center px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-lg shadow-md transition-all">
            <i class="ri-add-line mr-2 text-xl"></i>
            Thêm Trang Mới
        </button>
    </header>

    <div id="alert-container-wp" class="mb-6"></div>

    <div class="w-full">
        <div class="bg-slate-800/60 backdrop-blur-lg ring-1 ring-white/10 shadow-xl rounded-lg overflow-hidden">
            <div class="table-container">
                <table class="min-w-full">
                    <thead class="bg-slate-900/50 sticky top-0">
                        <tr>
                            <th class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-white sm:pl-6 w-1/3">Tên Trang</th>
                            <th class="px-3 py-3.5 text-left text-sm font-semibold text-white w-1/3">URL</th>
                            <th class="py-3.5 pl-3 pr-4 sm:pr-6 w-1/6 text-center text-sm font-semibold text-white">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="wp-sites-table-body" class="divide-y divide-slate-800"></tbody>
                </table>
                <div id="wp-table-placeholder" class="hidden">
                    <div class="p-12 text-center text-slate-500">
                        <i class="ri-database-2-line text-5xl"></i>
                        <p class="mt-4 text-lg">Chưa có trang Wordpress nào được thêm.</p>
                    </div>
                </div>
            </div>
        </div>
    </div> 

    <div id="wpSiteModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div id="wpModalBackdrop" class="fixed inset-0 bg-black/70 backdrop-blur-sm transition-opacity"></div>
        
        <div class="relative w-full max-w-5xl bg-slate-800 ring-1 ring-white/10 rounded-xl shadow-2xl overflow-hidden transform transition-all scale-100 max-h-[95vh] flex flex-col">
            
            <div class="px-6 py-4 border-b border-slate-700 flex items-center justify-between bg-slate-900/50 sticky top-0 z-10 flex-shrink-0">
                <h3 id="wp-form-title" class="text-xl font-bold text-white flex items-center">
                    <i class="ri-add-line mr-2 text-emerald-400"></i>
                    Thêm Trang Mới
                </h3>
                <button id="wpModalCloseBtn" class="text-slate-400 hover:text-white transition-colors">
                    <i class="ri-close-line text-2xl"></i>
                </button>
            </div>

            <div class="p-6 overflow-y-auto custom-scrollbar flex-1">
                <div id="modal-alert-container" class="hidden mb-4 p-3 rounded bg-red-900/50 border border-red-500/50 text-red-200 text-sm flex items-start">
                    <i class="ri-error-warning-fill mr-2 mt-0.5"></i>
                    <span id="modal-alert-msg">Lỗi rồi Bro!</span>
                </div>

                <form id="wp-site-form" class="space-y-6">
                    <input type="hidden" id="wp-site-id" name="id" value="">

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        
                        <div class="space-y-5">
                            <h4 class="text-emerald-400 font-bold uppercase text-xs tracking-wider border-b border-slate-700 pb-2 mb-4">
                                1. Cấu hình Kết nối & Media
                            </h4>

                            <div>
                                <label for="wp-site-name" class="block text-sm font-medium text-slate-300 mb-2">Tên Trang (Gợi nhớ)</label>
                                <input type="text" id="wp-site-name" name="siteName" class="w-full p-3 bg-slate-900/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition" placeholder="Vd: Blog Game Mod" required>
                            </div>
                            
                            <div>
                                <label for="wp-site-url" class="block text-sm font-medium text-slate-300 mb-2">URL Trang Wordpress</label>
                                <input type="text" id="wp-site-url" name="siteUrl" class="w-full p-3 bg-slate-900/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition" placeholder="https://myblog.com" required>
                            </div>
                
                            <div>
                                <label for="wp-api-key" class="block text-sm font-medium text-slate-300 mb-2">Application Password (API Key)</label>
                                <div class="relative">
                                    <input type="text" id="wp-api-key" name="apiKey" class="w-full p-3 bg-slate-900/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition pr-10" placeholder="username:abcd efgh ijkl mnop" required>
                                    <i class="ri-key-2-line absolute right-3 top-3.5 text-slate-500"></i>
                                </div>
                                <p class="text-[10px] text-slate-500 mt-1 italic">Vào WP Admin -> Users -> Profile -> Add New Application Password.</p>
                            </div>

                            <div class="border-t border-slate-700/50 my-4"></div>

                            <div>
                                <label for="wp-featured-alt" class="block text-sm font-medium text-slate-300 mb-2">Featured Image ALT</label>
                                <input type="text" id="wp-featured-alt" name="featuredImageAlt" class="w-full p-3 bg-slate-900/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition text-sm" placeholder="Vd: Tải {title} Mod Apk">
                            </div>

                            <div>
                                <label for="wp-gallery-alt" class="block text-sm font-medium text-slate-300 mb-2">Gallery Images ALT (Random theo dòng)</label>
                                <textarea id="wp-gallery-alt" name="galleryAlt" rows="4" class="w-full p-3 bg-slate-900/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition text-sm" placeholder="Vd: 
Ảnh màn hình {title}
Tải game {title} miễn phí
Hình ảnh đẹp của {title}"></textarea>
                                <p class="text-[10px] text-slate-500 mt-1">Nhập nhiều dòng, hệ thống sẽ chọn ngẫu nhiên 1 dòng. Dùng <code>{i}</code> nếu muốn đánh số thứ tự.</p>
                            </div>

                            <div>
                                <label for="wp-screenshot-mode" class="block text-sm font-medium text-slate-300 mb-2">Chế độ hiển thị ảnh màn hình</label>
                                <select id="wp-screenshot-mode" name="screenshotMode" class="w-full p-3 bg-slate-900/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition text-sm">
                                    <option value="gallery" selected>Gallery (Mặc định)</option>
                                    <option value="normal">Ảnh thường (Căn giữa)</option>
                                </select>
                                <p class="text-[10px] text-slate-500 mt-1">Gallery dùng shortcode <code>[gallery]</code>. Ảnh thường dùng thẻ <code>&lt;img&gt;</code>.</p>
                            </div>

                            <div>
                                <label for="wp-download-link" class="block text-sm font-medium text-slate-300 mb-2">Download Button HTML</label>
                                <textarea id="wp-download-link" name="downloadLink" rows="3" class="w-full p-3 bg-slate-900/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition font-mono text-sm" placeholder='Vd: <a href="{url}" class="btn-download">Tải {title} v{version}</a>'></textarea>
                                <p class="text-[10px] text-slate-500 mt-1">Sẽ được chèn vào cuối bài viết.</p>
                            </div>

                            <div>
                                <label for="wp-download-wait" class="block text-sm font-medium text-slate-300 mb-2">Thời gian chờ Download (Giây)</label>
                                <input type="number" id="wp-download-wait" name="downloadWaitTime" class="w-full p-3 bg-slate-900/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition text-sm" placeholder="Nhập 0 để tắt" min="0">
                                <p class="text-[10px] text-slate-500 mt-1">Nếu > 0, nút download sẽ đếm ngược (Xin chờ x giây...) trước khi chuyển hướng.</p>
                            </div>
                        </div>

                        <div class="space-y-5">
                            <h4 class="text-purple-400 font-bold uppercase text-xs tracking-wider border-b border-slate-700 pb-2 mb-4 flex justify-between items-center">
                                <span>2. Cấu hình AI Prompts</span>
                                <span class="text-[10px] bg-purple-500/10 text-purple-300 px-2 py-0.5 rounded border border-purple-500/20">Hỗ trợ Full Shortcode</span>
                            </h4>

                            <div class="bg-slate-900/80 p-3 rounded-lg border border-slate-700/50 mb-4">
                                <p class="text-[11px] font-bold text-slate-400 mb-2 uppercase">Các biến (Shortcode) dùng được ở mọi nơi:</p>
                                <div class="flex flex-wrap gap-1.5 font-mono text-[10px]">
                                    <span class="bg-emerald-900/30 text-emerald-400 px-1.5 py-0.5 rounded border border-emerald-500/20" title="Tên App">{title}</span>
                                    <span class="bg-emerald-900/30 text-emerald-400 px-1.5 py-0.5 rounded border border-emerald-500/20" title="Tóm tắt ngắn">{summary}</span>
                                    <span class="bg-emerald-900/30 text-emerald-400 px-1.5 py-0.5 rounded border border-emerald-500/20" title="Mô tả đầy đủ">{description}</span>
                                    <span class="bg-emerald-900/30 text-emerald-400 px-1.5 py-0.5 rounded border border-emerald-500/20" title="Nhà phát triển">{developer}</span>
                                    <span class="bg-purple-900/30 text-purple-400 px-1.5 py-0.5 rounded border border-purple-500/20" title="Phiên bản">{version}</span>
                                    <span class="bg-purple-900/30 text-purple-400 px-1.5 py-0.5 rounded border border-purple-500/20" title="Dung lượng">{size}</span>
                                    <span class="bg-purple-900/30 text-purple-400 px-1.5 py-0.5 rounded border border-purple-500/20" title="Ngày cập nhật">{updated}</span>
                                    <span class="bg-blue-900/30 text-blue-400 px-1.5 py-0.5 rounded border border-blue-500/20" title="URL Google Play">{url}</span>
                                    <span class="bg-blue-900/30 text-blue-400 px-1.5 py-0.5 rounded border border-blue-500/20" title="Điểm đánh giá">{score}</span>
                                    <span class="bg-blue-900/30 text-blue-400 px-1.5 py-0.5 rounded border border-blue-500/20" title="Thể loại">{genre}</span>
                                    <span class="bg-pink-900/30 text-pink-400 px-1.5 py-0.5 rounded border border-pink-500/20" title="Số thứ tự ảnh (1, 2, 3...)">{i}</span>
                                </div>
                            </div>

                            <div>
                                <label for="wp-ai-prompt-title" class="block text-sm font-medium text-slate-300 mb-2">Prompt Tiêu đề Bài viết</label>
                                <input type="text" id="wp-ai-prompt-title" name="aiPromptTitle" class="w-full p-3 bg-slate-900/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition text-sm" placeholder="Vd: Tải {title} Mod Premium v{version} cho Android">
                            </div>

                            <div>
                                <label for="wp-ai-prompt-excerpt" class="block text-sm font-medium text-slate-300 mb-2">Prompt Tóm tắt (Excerpt)</label>
                                <textarea id="wp-ai-prompt-excerpt" name="aiPromptExcerpt" rows="2" class="w-full p-3 bg-slate-900/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition font-mono text-sm" placeholder="Vd: Viết đoạn intro ngắn hấp dẫn về {title}..."></textarea>
                            </div>

                            <div>
                                <label for="wp-ai-prompt" class="block text-sm font-medium text-slate-300 mb-2">Prompt Nội dung chính (Bài viết)</label>
                                <textarea id="wp-ai-prompt" name="aiPrompt" rows="6" class="w-full p-3 bg-slate-900/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition font-mono text-sm" placeholder="Vd: Viết bài review chi tiết về game {title}. Bao gồm các mục: Giới thiệu, Gameplay, Đồ họa. Dựa trên mô tả gốc: {description}"></textarea>
                            </div>

                            <div>
                                <label for="wp-ai-prompt-footer" class="block text-sm font-medium text-slate-300 mb-2">Prompt Footer (Lời kết/FAQ)</label>
                                <textarea id="wp-ai-prompt-footer" name="aiPromptFooter" rows="2" class="w-full p-3 bg-slate-900/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition font-mono text-sm" placeholder="Vd: Viết lời kết và kêu gọi tải {title}..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-4 pt-4 border-t border-slate-700 mt-6 bg-slate-900/50 -mx-6 -mb-6 px-6 py-4 sticky bottom-0 z-10">
                        <button id="wp-form-cancel" type="button" class="flex-1 py-3 px-4 bg-slate-700 hover:bg-slate-600 text-slate-300 font-medium rounded-lg transition-all duration-200">
                            Hủy
                        </button>
                        <button id="wp-form-submit" type="submit" class="flex-[3] flex justify-center items-center py-3 px-4 bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-bold rounded-lg shadow-lg transform transition-all duration-200">
                            <i id="wp-btn-icon" class="ri-add-line text-xl mr-2"></i>
                            <span id="wp-btn-text">Thêm Trang</span>
                        </button>
                    </div>

                </form>
            </div>
        </div>
    </div>

    <script>
        var initialWpSites = <%- JSON.stringify(wpSites || []) %>;
    </script>
</body>